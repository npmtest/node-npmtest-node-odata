{"/home/travis/build/npmtest/node-npmtest-node-odata/test.js":"/* istanbul instrument in package npmtest_node_odata */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        switch (local.modeJs) {\n        // re-init local from window.local\n        case 'browser':\n            local = local.global.utility2.objectSetDefault(\n                local.global.utility2_rollup || local.global.local,\n                local.global.utility2\n            );\n            break;\n        // re-init local from example.js\n        case 'node':\n            local = (local.global.utility2_rollup || require('utility2'))\n                .requireExampleJsFromReadme();\n            break;\n        }\n        // export local\n        local.global.local = local;\n    }());\n\n\n\n    // run shared js-env code - function\n    (function () {\n        return;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // run browser js-env code - function\n    case 'browser':\n        break;\n\n\n\n    // run node js-env code - function\n    case 'node':\n        break;\n    }\n\n\n\n    // run shared js-env code - post-init\n    (function () {\n        return;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // run browser js-env code - post-init\n    case 'browser':\n        local.testCase_browser_nullCase = local.testCase_browser_nullCase || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test browsers's null-case handling-behavior-behavior\n         */\n            onError(null, options);\n        };\n\n        // run tests\n        local.nop(local.modeTest &&\n            document.querySelector('#testRunButton1') &&\n            document.querySelector('#testRunButton1').click());\n        break;\n\n\n\n    // run node js-env code - post-init\n    /* istanbul ignore next */\n    case 'node':\n        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildApidoc's default handling-behavior-behavior\n         */\n            options = { modulePathList: module.paths };\n            local.buildApidoc(options, onError);\n        };\n\n        local.testCase_buildApp_default = local.testCase_buildApp_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildApp's default handling-behavior-behavior\n         */\n            local.testCase_buildReadme_default(options, local.onErrorThrow);\n            local.testCase_buildLib_default(options, local.onErrorThrow);\n            local.testCase_buildTest_default(options, local.onErrorThrow);\n            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);\n            options = [];\n            local.buildApp(options, onError);\n        };\n\n        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||\n            function (options, onError) {\n            /*\n             * this function will test buildCustomOrg's default handling-behavior\n             */\n                options = {};\n                local.buildCustomOrg(options, onError);\n            };\n\n        local.testCase_buildLib_default = local.testCase_buildLib_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildLib's default handling-behavior\n         */\n            options = {};\n            local.buildLib(options, onError);\n        };\n\n        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildReadme's default handling-behavior-behavior\n         */\n            options = {};\n            local.buildReadme(options, onError);\n        };\n\n        local.testCase_buildTest_default = local.testCase_buildTest_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildTest's default handling-behavior\n         */\n            options = {};\n            local.buildTest(options, onError);\n        };\n\n        local.testCase_webpage_default = local.testCase_webpage_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test webpage's default handling-behavior\n         */\n            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };\n            local.browserTest(options, onError);\n        };\n\n        // run test-server\n        local.testRunServer(local);\n        break;\n    }\n}());\n","/home/travis/build/npmtest/node-npmtest-node-odata/lib.npmtest_node_odata.js":"/* istanbul instrument in package npmtest_node_odata */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        // init utility2_rollup\n        local = local.global.utility2_rollup || local;\n        // init lib\n        local.local = local.npmtest_node_odata = local;\n        // init exports\n        if (local.modeJs === 'browser') {\n            local.global.utility2_npmtest_node_odata = local;\n        } else {\n            module.exports = local;\n            module.exports.__dirname = __dirname;\n            module.exports.module = module;\n        }\n    }());\n}());\n","/home/travis/build/npmtest/node-npmtest-node-odata/example.js":"/*\nexample.js\n\nquickstart example\n\ninstruction\n    1. save this script as example.js\n    2. run the shell command:\n        $ npm install npmtest-node-odata && PORT=8081 node example.js\n    3. play with the browser-demo on http://127.0.0.1:8081\n*/\n\n\n\n/* istanbul instrument in package npmtest_node_odata */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        // init utility2_rollup\n        local = local.global.utility2_rollup || (local.modeJs === 'browser'\n            ? local.global.utility2_npmtest_node_odata\n            : global.utility2_moduleExports);\n        // export local\n        local.global.local = local;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // post-init\n    // run browser js-env code - post-init\n    /* istanbul ignore next */\n    case 'browser':\n        local.testRunBrowser = function (event) {\n            if (!event || (event &&\n                    event.currentTarget &&\n                    event.currentTarget.className &&\n                    event.currentTarget.className.includes &&\n                    event.currentTarget.className.includes('onreset'))) {\n                // reset output\n                Array.from(\n                    document.querySelectorAll('body > .resettable')\n                ).forEach(function (element) {\n                    switch (element.tagName) {\n                    case 'INPUT':\n                    case 'TEXTAREA':\n                        element.value = '';\n                        break;\n                    default:\n                        element.textContent = '';\n                    }\n                });\n            }\n            switch (event && event.currentTarget && event.currentTarget.id) {\n            case 'testRunButton1':\n                // show tests\n                if (document.querySelector('#testReportDiv1').style.display === 'none') {\n                    document.querySelector('#testReportDiv1').style.display = 'block';\n                    document.querySelector('#testRunButton1').textContent =\n                        'hide internal test';\n                    local.modeTest = true;\n                    local.testRunDefault(local);\n                // hide tests\n                } else {\n                    document.querySelector('#testReportDiv1').style.display = 'none';\n                    document.querySelector('#testRunButton1').textContent = 'run internal test';\n                }\n                break;\n            // custom-case\n            default:\n                break;\n            }\n            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&\n                    event.currentTarget &&\n                    event.currentTarget.className &&\n                    event.currentTarget.className.includes &&\n                    event.currentTarget.className.includes('oneval')))) {\n                // try to eval input-code\n                try {\n                    /*jslint evil: true*/\n                    eval(document.querySelector('#inputTextareaEval1').value);\n                } catch (errorCaught) {\n                    console.error(errorCaught);\n                }\n            }\n        };\n        // log stderr and stdout to #outputTextareaStdout1\n        ['error', 'log'].forEach(function (key) {\n            console[key + '_original'] = console[key];\n            console[key] = function () {\n                var element;\n                console[key + '_original'].apply(console, arguments);\n                element = document.querySelector('#outputTextareaStdout1');\n                if (!element) {\n                    return;\n                }\n                // append text to #outputTextareaStdout1\n                element.value += Array.from(arguments).map(function (arg) {\n                    return typeof arg === 'string'\n                        ? arg\n                        : JSON.stringify(arg, null, 4);\n                }).join(' ') + '\\n';\n                // scroll textarea to bottom\n                element.scrollTop = element.scrollHeight;\n            };\n        });\n        // init event-handling\n        ['change', 'click', 'keyup'].forEach(function (event) {\n            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {\n                element.addEventListener(event, local.testRunBrowser);\n            });\n        });\n        // run tests\n        local.testRunBrowser();\n        break;\n\n\n\n    // run node js-env code - post-init\n    /* istanbul ignore next */\n    case 'node':\n        // export local\n        module.exports = local;\n        // require modules\n        local.fs = require('fs');\n        local.http = require('http');\n        local.url = require('url');\n        // init assets\n        local.assetsDict = local.assetsDict || {};\n        /* jslint-ignore-begin */\n        local.assetsDict['/assets.index.template.html'] = '\\\n<!doctype html>\\n\\\n<html lang=\"en\">\\n\\\n<head>\\n\\\n<meta charset=\"UTF-8\">\\n\\\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\\n<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\\n<style>\\n\\\n/*csslint\\n\\\n    box-sizing: false,\\n\\\n    universal-selector: false\\n\\\n*/\\n\\\n* {\\n\\\n    box-sizing: border-box;\\n\\\n}\\n\\\nbody {\\n\\\n    background: #dde;\\n\\\n    font-family: Arial, Helvetica, sans-serif;\\n\\\n    margin: 2rem;\\n\\\n}\\n\\\nbody > * {\\n\\\n    margin-bottom: 1rem;\\n\\\n}\\n\\\n.utility2FooterDiv {\\n\\\n    margin-top: 20px;\\n\\\n    text-align: center;\\n\\\n}\\n\\\n</style>\\n\\\n<style>\\n\\\n/*csslint\\n\\\n*/\\n\\\ntextarea {\\n\\\n    font-family: monospace;\\n\\\n    height: 10rem;\\n\\\n    width: 100%;\\n\\\n}\\n\\\ntextarea[readonly] {\\n\\\n    background: #ddd;\\n\\\n}\\n\\\n</style>\\n\\\n</head>\\n\\\n<body>\\n\\\n<!-- utility2-comment\\n\\\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\\nutility2-comment -->\\n\\\n<h1>\\n\\\n<!-- utility2-comment\\n\\\n    <a\\n\\\n        {{#if env.npm_package_homepage}}\\n\\\n        href=\"{{env.npm_package_homepage}}\"\\n\\\n        {{/if env.npm_package_homepage}}\\n\\\n        target=\"_blank\"\\n\\\n    >\\n\\\nutility2-comment -->\\n\\\n        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\\n<!-- utility2-comment\\n\\\n    </a>\\n\\\nutility2-comment -->\\n\\\n</h1>\\n\\\n<h3>{{env.npm_package_description}}</h3>\\n\\\n<!-- utility2-comment\\n\\\n<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\\n<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\\n<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\\nutility2-comment -->\\n\\\n\\n\\\n\\n\\\n\\n\\\n<label>stderr and stdout</label>\\n\\\n<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\\n<!-- utility2-comment\\n\\\n{{#if isRollup}}\\n\\\n<script src=\"assets.app.js\"></script>\\n\\\n{{#unless isRollup}}\\n\\\nutility2-comment -->\\n\\\n<script src=\"assets.utility2.rollup.js\"></script>\\n\\\n<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\\n<script src=\"assets.npmtest_node_odata.rollup.js\"></script>\\n\\\n<script src=\"assets.example.js\"></script>\\n\\\n<script src=\"assets.test.js\"></script>\\n\\\n<!-- utility2-comment\\n\\\n{{/if isRollup}}\\n\\\nutility2-comment -->\\n\\\n<div class=\"utility2FooterDiv\">\\n\\\n    [ this app was created with\\n\\\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\\n    ]\\n\\\n</div>\\n\\\n</body>\\n\\\n</html>\\n\\\n';\n        /* jslint-ignore-end */\n        if (local.templateRender) {\n            local.assetsDict['/'] = local.templateRender(\n                local.assetsDict['/assets.index.template.html'],\n                {\n                    env: local.objectSetDefault(local.env, {\n                        npm_package_description: 'the greatest app in the world!',\n                        npm_package_name: 'my-app',\n                        npm_package_nameAlias: 'my_app',\n                        npm_package_version: '0.0.1'\n                    })\n                }\n            );\n        } else {\n            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']\n                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {\n                    // jslint-hack\n                    String(match0);\n                    switch (match1) {\n                    case 'npm_package_description':\n                        return 'the greatest app in the world!';\n                    case 'npm_package_name':\n                        return 'my-app';\n                    case 'npm_package_nameAlias':\n                        return 'my_app';\n                    case 'npm_package_version':\n                        return '0.0.1';\n                    }\n                });\n        }\n        // run the cli\n        if (local.global.utility2_rollup || module !== require.main) {\n            break;\n        }\n        local.assetsDict['/assets.example.js'] =\n            local.assetsDict['/assets.example.js'] ||\n            local.fs.readFileSync(__filename, 'utf8');\n        // bug-workaround - long $npm_package_buildCustomOrg\n        /* jslint-ignore-begin */\n        local.assetsDict['/assets.npmtest_node_odata.rollup.js'] =\n            local.assetsDict['/assets.npmtest_node_odata.rollup.js'] ||\n            local.fs.readFileSync(\n                local.npmtest_node_odata.__dirname + '/lib.npmtest_node_odata.js',\n                'utf8'\n            ).replace((/^#!/), '//');\n        /* jslint-ignore-end */\n        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';\n        // if $npm_config_timeout_exit exists,\n        // then exit this process after $npm_config_timeout_exit ms\n        if (Number(process.env.npm_config_timeout_exit)) {\n            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\n        }\n        // start server\n        if (local.global.utility2_serverHttp1) {\n            break;\n        }\n        process.env.PORT = process.env.PORT || '8081';\n        console.error('server starting on port ' + process.env.PORT);\n        local.http.createServer(function (request, response) {\n            request.urlParsed = local.url.parse(request.url);\n            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {\n                response.end(local.assetsDict[request.urlParsed.pathname]);\n                return;\n            }\n            response.statusCode = 404;\n            response.end();\n        }).listen(process.env.PORT);\n        break;\n    }\n}());\n","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/index.js":"module.exports = require(\"./lib\").default;\n","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/index.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _server = require('./server');\n\nvar _server2 = _interopRequireDefault(_server);\n\nvar _ODataResource = require('./ODataResource');\n\nvar _ODataResource2 = _interopRequireDefault(_ODataResource);\n\nvar _ODataFunction = require('./ODataFunction');\n\nvar _ODataFunction2 = _interopRequireDefault(_ODataFunction);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar server = function server(db, prefix) {\n  return new _server2.default(db, prefix);\n};\n\nserver.Resource = function createResouce(name, model) {\n  return new _ODataResource2.default(name, model);\n};\n\nserver.Function = function createFunction() {\n  return new _ODataFunction2.default();\n};\n\nserver._express = _express2.default;\n\nexports.default = server;","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/server.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nvar _express = require('./express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _ODataResource = require('./ODataResource');\n\nvar _ODataResource2 = _interopRequireDefault(_ODataResource);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n_mongoose2.default.Promise = global.Promise;\n\nfunction checkAuth(auth, req) {\n  return !auth || auth(req);\n}\n\nvar Server = function () {\n  function Server(db, prefix) {\n    _classCallCheck(this, Server);\n\n    this._app = (0, _express2.default)();\n    this._mongoose = _mongoose2.default;\n    this._settings = {\n      maxTop: 10000,\n      maxSkip: 10000,\n      orderby: undefined\n    };\n    this.defaultConfiguration(db, prefix);\n\n    // TODO: Infact, resources is a mongooseModel instance, origin name is repositories.\n    // Should mix _resources object and resources object: _resources + resource = resources.\n    // Encapsulation to a object, separate mognoose, try to use *repository pattern*.\n    // 这里也许应该让 resources 支持 odata 查询的, 以方便直接在代码中使用 OData 查询方式来进行数据筛选, 达到隔离 mongo 的效果.\n    this._resources = [];\n    this.resources = {};\n  }\n\n  _createClass(Server, [{\n    key: 'defaultConfiguration',\n    value: function defaultConfiguration(db) {\n      var prefix = arguments.length <= 1 || arguments[1] === undefined ? '' : arguments[1];\n\n      this.set('app', this._app);\n      this.set('db', db);\n      this.set('prefix', prefix);\n    }\n  }, {\n    key: 'resource',\n    value: function resource(name, model) {\n      if (model === undefined) {\n        return this._resources.name;\n      }\n      var resource = new _ODataResource2.default(name, model);\n      this._resources.push(resource);\n      return resource;\n    }\n  }, {\n    key: 'post',\n    value: function post(url, callback, auth) {\n      var app = this.get('app');\n      var prefix = this.get('prefix');\n      app.post('' + prefix + url, function (req, res, next) {\n        if (checkAuth(auth, req)) {\n          callback(req, res, next);\n        } else {\n          res.status(401).end();\n        }\n      });\n    }\n  }, {\n    key: 'put',\n    value: function put(url, callback, auth) {\n      var app = this.get('app');\n      var prefix = this.get('prefix');\n      app.put('' + prefix + url, function (req, res, next) {\n        if (checkAuth(auth, req)) {\n          callback(req, res, next);\n        } else {\n          res.status(401).end();\n        }\n      });\n    }\n  }, {\n    key: 'delete',\n    value: function _delete(url, callback, auth) {\n      var app = this.get('app');\n      var prefix = this.get('prefix');\n      app.delete('' + prefix + url, function (req, res, next) {\n        if (checkAuth(auth, req)) {\n          callback(req, res, next);\n        } else {\n          res.status(401).end();\n        }\n      });\n    }\n  }, {\n    key: 'patch',\n    value: function patch(url, callback, auth) {\n      var app = this.get('app');\n      var prefix = this.get('prefix');\n      app.patch('' + prefix + url, function (req, res, next) {\n        if (checkAuth(auth, req)) {\n          callback(req, res, next);\n        } else {\n          res.status(401).end();\n        }\n      });\n    }\n  }, {\n    key: 'listen',\n    value: function listen() {\n      var _this = this,\n          _app;\n\n      this._resources.map(function (resource) {\n        var router = resource._router(_this._db, _this._settings);\n        _this._app.use(_this.get('prefix'), router);\n        _this.resources[resource._name] = _this._db.model(resource._name);\n        return true;\n      });\n      return (_app = this._app).listen.apply(_app, arguments);\n    }\n  }, {\n    key: 'use',\n    value: function use() {\n      var _app2;\n\n      if ((arguments.length <= 0 ? undefined : arguments[0]) instanceof _ODataResource2.default) {\n        this._resources.push(arguments.length <= 0 ? undefined : arguments[0]);\n        return;\n      }\n      (_app2 = this._app).use.apply(_app2, arguments);\n    }\n  }, {\n    key: 'get',\n    value: function get(key, callback, auth) {\n      if (callback === undefined) {\n        return this._settings[key];\n      }\n      // TODO: Need to refactor, same as L70-L80\n      var app = this.get('app');\n      var prefix = this.get('prefix');\n      return app.get('' + prefix + key, function (req, res, next) {\n        if (checkAuth(auth, req)) {\n          callback(req, res, next);\n        } else {\n          res.status(401).end();\n        }\n      });\n    }\n  }, {\n    key: 'set',\n    value: function set(key, val) {\n      switch (key) {\n        case 'db':\n          {\n            var options = { server: { reconnectTries: Number.MAX_VALUE } };\n            this._db = _mongoose2.default.createConnection(val, options, function (err) {\n              if (err) {\n                console.error('Failed to connect to database on startup.');\n                process.exit();\n              }\n            });\n\n            this._settings[key] = val;\n            break;\n          }\n        case 'prefix':\n          {\n            var prefix = val;\n            if (prefix === '/') {\n              prefix = '';\n            }\n            if (prefix.length > 0 && prefix[0] !== '/') {\n              prefix = '/' + prefix;\n            }\n            this._settings[key] = prefix;\n            break;\n          }\n        default:\n          {\n            this._settings[key] = val;\n            break;\n          }\n      }\n      return this;\n    }\n\n    // provide a event listener to handle not able to connect DB.\n\n  }, {\n    key: 'on',\n    value: function on(name, event) {\n      if (['connected', 'disconnected'].indexOf(name) > -1) {\n        this._db.on(name, event);\n      }\n    }\n  }]);\n\n  return Server;\n}();\n\nexports.default = Server;","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/express.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  var app = (0, _express2.default)();\n  app.use(_bodyParser2.default.urlencoded({ extended: true }));\n  app.use(_bodyParser2.default.json());\n  app.use((0, _methodOverride2.default)());\n  app.use(_express2.default.query());\n  app.use((0, _cors2.default)());\n  app.disable('x-powered-by');\n  return app;\n};\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _bodyParser = require('body-parser');\n\nvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\nvar _methodOverride = require('method-override');\n\nvar _methodOverride2 = _interopRequireDefault(_methodOverride);\n\nvar _cors = require('cors');\n\nvar _cors2 = _interopRequireDefault(_cors);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/ODataResource.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _model = require('./model');\n\nvar _model2 = _interopRequireDefault(_model);\n\nvar _rest = require('./rest');\n\nvar _rest2 = _interopRequireDefault(_rest);\n\nvar _utils = require('./utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction hook(resource, pos, fn) {\n  var method = resource._currentMethod;\n  if (method === 'all') {\n    method = ['get', 'post', 'put', 'delete', 'patch', 'list'];\n  } else {\n    method = [method];\n  }\n  /*eslint-disable */\n  method.map(function (curr) {\n    if (resource._hooks[curr][pos]) {\n      (function () {\n        var _fn = resource._hooks[curr][pos];\n        resource._hooks[curr][pos] = function () {\n          for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n\n          _fn.apply(resource, args);\n          fn.apply(resource, args);\n        };\n      })();\n    } else {\n      resource._hooks[curr][pos] = fn;\n    }\n  });\n  /*eslint-enable */\n}\n\nvar _default = function () {\n  function _default(name, userModel) {\n    _classCallCheck(this, _default);\n\n    this._name = name;\n    this._url = name;\n    this._model = userModel;\n    this._hooks = {\n      list: {},\n      get: {},\n      post: {},\n      put: {},\n      delete: {},\n      patch: {}\n    };\n    this._actions = {};\n    this._options = {\n      maxTop: 10000,\n      maxSkip: 10000,\n      orderby: undefined\n    };\n  }\n\n  _createClass(_default, [{\n    key: 'action',\n    value: function action(url, fn, auth) {\n      this._actions[url] = fn;\n      this._actions[url].auth = auth;\n      return this;\n    }\n  }, {\n    key: 'maxTop',\n    value: function maxTop(count) {\n      this._maxTop = count;\n      return this;\n    }\n  }, {\n    key: 'maxSkip',\n    value: function maxSkip(count) {\n      this._maxSkip = count;\n      return this;\n    }\n  }, {\n    key: 'orderBy',\n    value: function orderBy(field) {\n      this._orderby = field;\n      return this;\n    }\n  }, {\n    key: 'list',\n    value: function list() {\n      this._currentMethod = 'list';\n      return this;\n    }\n  }, {\n    key: 'get',\n    value: function get() {\n      this._currentMethod = 'get';\n      return this;\n    }\n  }, {\n    key: 'post',\n    value: function post() {\n      this._currentMethod = 'post';\n      return this;\n    }\n  }, {\n    key: 'put',\n    value: function put() {\n      this._currentMethod = 'put';\n      return this;\n    }\n  }, {\n    key: 'delete',\n    value: function _delete() {\n      this._currentMethod = 'delete';\n      return this;\n    }\n  }, {\n    key: 'patch',\n    value: function patch() {\n      this._currentMethod = 'patch';\n      return this;\n    }\n  }, {\n    key: 'all',\n    value: function all() {\n      this._currentMethod = 'all';\n      return this;\n    }\n  }, {\n    key: 'before',\n    value: function before(fn) {\n      hook(this, 'before', fn);\n      return this;\n    }\n  }, {\n    key: 'after',\n    value: function after(fn) {\n      hook(this, 'after', fn);\n      return this;\n    }\n  }, {\n    key: 'auth',\n    value: function auth(fn) {\n      var _this = this;\n\n      var method = this._currentMethod;\n      if (method === 'all') {\n        method = ['get', 'post', 'put', 'delete', 'patch', 'list'];\n      } else {\n        method = [method];\n      }\n      method.map(function (curr) {\n        _this._hooks[curr].auth = fn;\n        return undefined;\n      });\n      return this;\n    }\n  }, {\n    key: 'url',\n    value: function url(_url) {\n      this._url = _url;\n      return this;\n    }\n  }, {\n    key: '_router',\n    value: function _router(db) {\n      var setting = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n      // remove '/' if url is startwith it.\n      if (this._url.indexOf('/') === 0) {\n        this._url = this._url.substr(1);\n      }\n\n      // not allow contain '/' in url.\n      if (this._url.indexOf('/') >= 0) {\n        throw new Error('Url of resource[' + this._name + '] can\\'t contain \"/\",' + 'it can only be allowed to exist in the beginning.');\n      }\n\n      var mongooseModel = _model2.default.register(db, this._url, this._model);\n\n      var params = {\n        url: this._url,\n        options: {\n          maxTop: (0, _utils.min)([setting.maxTop, this._maxTop]),\n          maxSkip: (0, _utils.min)([setting.maxSkip, this._maxSkip]),\n          orderby: this._orderby || setting.orderby\n        },\n        hooks: this._hooks,\n        actions: this._actions\n      };\n\n      return _rest2.default.getRouter(mongooseModel, params);\n    }\n  }]);\n\n  return _default;\n}();\n\nexports.default = _default;","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/model/index.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _mongoose = require('mongoose');\n\nvar _mongoose2 = _interopRequireDefault(_mongoose);\n\nvar _idPlugin = require('./idPlugin');\n\nvar _idPlugin2 = _interopRequireDefault(_idPlugin);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar register = function register(_db, name, model) {\n  var conf = {\n    _id: false,\n    versionKey: false,\n    collection: name\n  };\n  var schema = new _mongoose2.default.Schema(model, conf);\n  schema.plugin(_idPlugin2.default);\n  return _db.model(name, schema);\n};\n\nexports.default = { register: register };","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/model/idPlugin.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (schema) {\n  // add _id to schema.\n  if (!schema.paths._id) {\n    schema.add({\n      _id: {\n        type: String,\n        unique: true\n      }\n    });\n  }\n\n  // display value of _id when request id.\n  if (!schema.paths.id) {\n    schema.virtual('id').get(function getId() {\n      return this._id;\n    });\n    schema.set('toObject', { virtuals: true });\n    schema.set('toJSON', { virtuals: true });\n  }\n\n  // reomove _id when serialization.\n  if (!schema.options.toObject) {\n    schema.options.toObject = {};\n  }\n  if (!schema.options.toJSON) {\n    schema.options.toJSON = {};\n  }\n  var remove = function remove(doc, ret) {\n    delete ret._id;\n    if (!ret.id) {\n      delete ret.id;\n    }\n    return ret;\n  };\n  schema.options.toObject.transform = remove;\n  schema.options.toJSON.transform = remove;\n\n  // genarate _id.\n  schema.pre('save', function preSave(next) {\n    if (this.isNew && !this._id) {\n      if (this.id) {\n        // Use a user-defined id to save\n        this._id = this.id;\n      } else {\n        // Use uuid to save\n        this._id = _nodeUuid2.default.v4();\n      }\n    }\n    return next();\n  });\n};\n\nvar _nodeUuid = require('node-uuid');\n\nvar _nodeUuid2 = _interopRequireDefault(_nodeUuid);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/rest/index.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _http = require('http');\n\nvar _http2 = _interopRequireDefault(_http);\n\nvar _express = require('express');\n\nvar _list = require('./list');\n\nvar _list2 = _interopRequireDefault(_list);\n\nvar _post = require('./post');\n\nvar _post2 = _interopRequireDefault(_post);\n\nvar _put = require('./put');\n\nvar _put2 = _interopRequireDefault(_put);\n\nvar _delete = require('./delete');\n\nvar _delete2 = _interopRequireDefault(_delete);\n\nvar _patch = require('./patch');\n\nvar _patch2 = _interopRequireDefault(_patch);\n\nvar _get = require('./get');\n\nvar _get2 = _interopRequireDefault(_get);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction authorizePipe(req, res, auth) {\n  return new Promise(function (resolve, reject) {\n    if (auth !== undefined) {\n      if (!auth(req, res)) {\n        return reject({ status: 401 });\n      }\n    }\n    return resolve();\n  });\n}\n\nfunction beforePipe(req, res, before) {\n  return new Promise(function (resolve) {\n    if (before) {\n      before(req.body, req, res);\n    }\n    resolve();\n  });\n}\n\nfunction respondPipe(req, res, result) {\n  return new Promise(function (resolve) {\n    var status = result.status || 200;\n    var data = result.entity;\n    res.status(status).jsonp(data);\n    resolve(data);\n  });\n}\n\nfunction afterPipe(req, res, after, data) {\n  return new Promise(function (resolve) {\n    if (after) {\n      after(data, req.body, req, res);\n    }\n    resolve();\n  });\n}\n\nfunction errorPipe(req, res, err) {\n  return new Promise(function () {\n    var status = err.status || 500;\n    var text = err.text || err.message || _http2.default.STATUS_CODES[status];\n    res.status(status).send(text);\n  });\n}\n\nfunction addRestRoutes(router, routes, mongooseModel, options) {\n  return routes.map(function (route) {\n    var method = route.method;\n    var url = route.url;\n    var ctrl = route.ctrl;\n    var hook = route.hook;\n\n    return router[method](url, function (req, res) {\n      authorizePipe(req, res, hook.auth).then(function () {\n        return beforePipe(req, res, hook.before);\n      }).then(function () {\n        return ctrl(req, mongooseModel, options);\n      }).then(function (result) {\n        return respondPipe(req, res, result || {});\n      }).then(function (data) {\n        return afterPipe(req, res, hook.after, data);\n      }).catch(function (err) {\n        return errorPipe(req, res, err);\n      });\n    });\n  });\n}\n\nfunction addActionRoutes(router, resourceURL, actions) {\n  return Object.keys(actions).map(function (url) {\n    var action = actions[url];\n    return router.post('' + resourceURL + url, function (req, res, next) {\n      authorizePipe(req, res, action.auth).then(function () {\n        return action(req, res, next);\n      }).catch(function (result) {\n        return errorPipe(req, res, result);\n      });\n    });\n  });\n}\n\nvar getRouter = function getRouter(mongooseModel, _ref) {\n  var url = _ref.url;\n  var hooks = _ref.hooks;\n  var actions = _ref.actions;\n  var options = _ref.options;\n\n  var resourceListURL = '/' + url;\n  var resourceURL = resourceListURL + '\\\\(:id\\\\)';\n\n  var routes = [{\n    method: 'post',\n    url: resourceListURL,\n    ctrl: _post2.default,\n    hook: hooks.post\n  }, {\n    method: 'put',\n    url: resourceURL,\n    ctrl: _put2.default,\n    hook: hooks.put\n  }, {\n    method: 'patch',\n    url: resourceURL,\n    controller: _patch2.default,\n    config: hooks.patch\n  }, {\n    method: 'delete',\n    url: resourceURL,\n    ctrl: _delete2.default,\n    hook: hooks.delete\n  }, {\n    method: 'get',\n    url: resourceURL,\n    ctrl: _get2.default,\n    hook: hooks.get\n  }, {\n    method: 'get',\n    url: resourceListURL,\n    ctrl: _list2.default,\n    hook: hooks.list\n  }];\n\n  /*eslint-disable */\n  var router = (0, _express.Router)();\n  /*eslint-enable */\n  addRestRoutes(router, routes, mongooseModel, options);\n  addActionRoutes(router, resourceURL, actions);\n  return router;\n};\n\nexports.default = { getRouter: getRouter };","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/rest/list.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _countParser = require('../parser/countParser');\n\nvar _countParser2 = _interopRequireDefault(_countParser);\n\nvar _filterParser = require('../parser/filterParser');\n\nvar _filterParser2 = _interopRequireDefault(_filterParser);\n\nvar _orderbyParser = require('../parser/orderbyParser');\n\nvar _orderbyParser2 = _interopRequireDefault(_orderbyParser);\n\nvar _skipParser = require('../parser/skipParser');\n\nvar _skipParser2 = _interopRequireDefault(_skipParser);\n\nvar _topParser = require('../parser/topParser');\n\nvar _topParser2 = _interopRequireDefault(_topParser);\n\nvar _selectParser = require('../parser/selectParser');\n\nvar _selectParser2 = _interopRequireDefault(_selectParser);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _countQuery(model, _ref) {\n  var count = _ref.count;\n  var filter = _ref.filter;\n\n  return new Promise(function (resolve, reject) {\n    (0, _countParser2.default)(model, count, filter).then(function (dataCount) {\n      return dataCount !== undefined ? resolve({ '@odata.count': dataCount }) : resolve({});\n    }).catch(reject);\n  });\n}\n\nfunction _dataQuery(model, _ref2, options) {\n  var filter = _ref2.filter;\n  var orderby = _ref2.orderby;\n  var skip = _ref2.skip;\n  var top = _ref2.top;\n  var select = _ref2.select;\n\n  return new Promise(function (resolve, reject) {\n    var query = model.find();\n    (0, _filterParser2.default)(query, filter).then(function () {\n      return (0, _orderbyParser2.default)(query, orderby || options.orderby);\n    }).then(function () {\n      return (0, _skipParser2.default)(query, skip, options.maxSkip);\n    }).then(function () {\n      return (0, _topParser2.default)(query, top, options.maxTop);\n    }).then(function () {\n      return (0, _selectParser2.default)(query, select);\n    }).then(function () {\n      return query.exec(function (err, data) {\n        if (err) {\n          return reject(err);\n        }\n        return resolve({ value: data });\n      });\n    }).catch(reject);\n  });\n}\n\nexports.default = function (req, MongooseModel, options) {\n  return new Promise(function (resolve, reject) {\n    var params = {\n      count: req.query.$count,\n      filter: req.query.$filter,\n      orderby: req.query.$orderby,\n      skip: req.query.$skip,\n      top: req.query.$top,\n      select: req.query.$select\n    };\n\n    Promise.all([_countQuery(MongooseModel, params), _dataQuery(MongooseModel, params, options)]).then(function (results) {\n      var entity = results.reduce(function (current, next) {\n        return _extends({}, current, next);\n      });\n      resolve({ entity: entity });\n    }).catch(function (err) {\n      return reject({ status: 500, text: err });\n    });\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/parser/countParser.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _filterParser = require('./filterParser');\n\nvar _filterParser2 = _interopRequireDefault(_filterParser);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// ?$count=10\n// ->\n// query.count(10)\nexports.default = function (mongooseModel, $count, $filter) {\n  return new Promise(function (resolve, reject) {\n    if ($count === undefined) {\n      return resolve();\n    }\n\n    switch ($count) {\n      case 'true':\n        {\n          var query = mongooseModel.find();\n          (0, _filterParser2.default)(query, $filter);\n          query.count(function (err, count) {\n            resolve(count);\n          });\n          break;\n        }\n      case 'false':\n        resolve();\n        break;\n      default:\n        reject('Unknown $count option, only \"true\" and \"false\" are supported.');\n        break;\n    }\n    return undefined;\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/parser/filterParser.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }(); // Operator  Description             Example\n// Comparison Operators\n// eq        Equal                   Address/City eq 'Redmond'\n// ne        Not equal               Address/City ne 'London'\n// gt        Greater than            Price gt 20\n// ge        Greater than or equal   Price ge 10\n// lt        Less than               Price lt 20\n// le        Less than or equal      Price le 100\n// has       Has flags               Style has Sales.Color'Yellow'    #todo\n// Logical Operators\n// and       Logical and             Price le 200 and Price gt 3.5\n// or        Logical or              Price le 3.5 or Price gt 200     #todo\n// not       Logical negation        not endswith(Description,'milk') #todo\n\n// eg.\n//   http://host/service/Products?$filter=Price lt 10.00\n//   http://host/service/Categories?$filter=Products/$count lt 10\n\nvar _functionsParser = require('./functionsParser');\n\nvar _functionsParser2 = _interopRequireDefault(_functionsParser);\n\nvar _utils = require('../utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar OPERATORS_KEYS = ['eq', 'ne', 'gt', 'ge', 'lt', 'le', 'has'];\n\nvar stringHelper = {\n  has: function has(str, key) {\n    return str.indexOf(key) >= 0;\n  },\n\n  isBeginWith: function isBeginWith(str, key) {\n    return str.indexOf(key) === 0;\n  },\n\n  isEndWith: function isEndWith(str, key) {\n    return str.lastIndexOf(key) === str.length - key.length;\n  },\n\n  removeEndOf: function removeEndOf(str, key) {\n    if (stringHelper.isEndWith(str, key)) {\n      return str.substr(0, str.length - key.length);\n    }\n    return str;\n  }\n};\n\nvar validator = {\n  formatValue: function formatValue(value) {\n    var val = void 0;\n    if (value === 'true') {\n      val = true;\n    } else if (value === 'false') {\n      val = false;\n    } else if (+value === +value) {\n      val = +value;\n    } else if (stringHelper.isBeginWith(value, \"'\") && stringHelper.isEndWith(value, \"'\")) {\n      val = value.slice(1, -1);\n    } else if (value === 'null') {\n      val = value;\n    } else {\n      return { err: 'Syntax error at \\'' + value + '\\'.' };\n    }\n    return { val: val };\n  }\n};\n\nexports.default = function (query, $filter) {\n  return new Promise(function (resolve, reject) {\n    if (!$filter) {\n      return resolve();\n    }\n\n    var condition = (0, _utils.split)($filter, ['and', 'or']).filter(function (item) {\n      return item !== 'and' && item !== 'or';\n    });\n\n    condition.map(function (item) {\n      // parse \"indexof(title,'X1ML') gt 0\"\n      var conditionArr = (0, _utils.split)(item, OPERATORS_KEYS);\n      if (conditionArr.length === 0) {\n        // parse \"contains(title,'X1ML')\"\n        conditionArr.push(item);\n      }\n      if (conditionArr.length !== 3 && conditionArr.length !== 1) {\n        return reject('Syntax error at \\'' + item + '\\'.');\n      }\n\n      var _conditionArr = _slicedToArray(conditionArr, 3);\n\n      var key = _conditionArr[0];\n      var odataOperator = _conditionArr[1];\n      var value = _conditionArr[2];\n\n\n      var val = void 0;\n      if (value !== undefined) {\n        var result = validator.formatValue(value);\n        if (result.err) {\n          return reject(result.err);\n        }\n        val = result.val;\n      }\n\n      // function query\n      var functionKey = key.substring(0, key.indexOf('('));\n      if (['indexof', 'year', 'contains'].indexOf(functionKey) > -1) {\n        _functionsParser2.default[functionKey](query, key, odataOperator, val);\n      } else {\n        if (conditionArr.length === 1) {\n          return reject('Syntax error at \\'' + item + '\\'.');\n        }\n        if (value === 'null') {\n          switch (odataOperator) {\n            case 'eq':\n              query.exists(key, false);\n              return resolve();\n            case 'ne':\n              query.exists(key, true);\n              return resolve();\n            default:\n              break;\n          }\n        }\n        // operator query\n        switch (odataOperator) {\n          case 'eq':\n            query.where(key).equals(val);\n            break;\n          case 'ne':\n            query.where(key).ne(val);\n            break;\n          case 'gt':\n            query.where(key).gt(val);\n            break;\n          case 'ge':\n            query.where(key).gte(val);\n            break;\n          case 'lt':\n            query.where(key).lt(val);\n            break;\n          case 'le':\n            query.where(key).lte(val);\n            break;\n          default:\n            return reject(\"Incorrect operator at '#{item}'.\");\n        }\n      }\n      return undefined;\n    });\n    return resolve();\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/parser/functionsParser.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar convertToOperator = function convertToOperator(odataOperator) {\n  var operator = void 0;\n  switch (odataOperator) {\n    case 'eq':\n      operator = '==';\n      break;\n    case 'ne':\n      operator = '!=';\n      break;\n    case 'gt':\n      operator = '>';\n      break;\n    case 'ge':\n      operator = '>=';\n      break;\n    case 'lt':\n      operator = '<';\n      break;\n    case 'le':\n      operator = '<=';\n      break;\n    default:\n      throw new Error('Invalid operator code, expected one of [\"==\", \"!=\", \">\", \">=\", \"<\", \"<=\"].');\n  }\n  return operator;\n};\n\n// contains(CompanyName,'icrosoft')\nvar contains = function contains(query, fnKey) {\n  var _fnKey$substring$spli = fnKey.substring(fnKey.indexOf('(') + 1, fnKey.indexOf(')')).split(',');\n\n  var _fnKey$substring$spli2 = _slicedToArray(_fnKey$substring$spli, 2);\n\n  var key = _fnKey$substring$spli2[0];\n  var target = _fnKey$substring$spli2[1];\n  var _ref = [key.trim(), target.trim()];\n  key = _ref[0];\n  target = _ref[1];\n\n  query.$where('this.' + key + '.indexOf(' + target + ') != -1');\n};\n\n// indexof(CompanyName,'X') eq 1\nvar indexof = function indexof(query, fnKey, odataOperator, value) {\n  var _fnKey$substring$spli3 = fnKey.substring(fnKey.indexOf('(') + 1, fnKey.indexOf(')')).split(',');\n\n  var _fnKey$substring$spli4 = _slicedToArray(_fnKey$substring$spli3, 2);\n\n  var key = _fnKey$substring$spli4[0];\n  var target = _fnKey$substring$spli4[1];\n  var _ref2 = [key.trim(), target.trim()];\n  key = _ref2[0];\n  target = _ref2[1];\n\n  var operator = convertToOperator(odataOperator);\n  query.$where('this.' + key + '.indexOf(' + target + ') ' + operator + ' ' + value);\n};\n\n// year(publish_date) eq 2000\nvar year = function year(query, fnKey, odataOperator, value) {\n  var key = fnKey.substring(fnKey.indexOf('(') + 1, fnKey.indexOf(')'));\n\n  var start = new Date(+value, 0, 1);\n  var end = new Date(+value + 1, 0, 1);\n\n  switch (odataOperator) {\n    case 'eq':\n      query.where(key).gte(start).lt(end);\n      break;\n    case 'ne':\n      {\n        var condition = [{}, {}];\n        condition[0][key] = { $lt: start };\n        condition[1][key] = { $gte: end };\n        query.or(condition);\n        break;\n      }\n    case 'gt':\n      query.where(key).gte(end);\n      break;\n    case 'ge':\n      query.where(key).gte(start);\n      break;\n    case 'lt':\n      query.where(key).lt(start);\n      break;\n    case 'le':\n      query.where(key).lt(end);\n      break;\n    default:\n      throw new Error('Invalid operator code, expected one of [\"==\", \"!=\", \">\", \">=\", \"<\", \"<=\"].');\n  }\n};\n\nexports.default = { indexof: indexof, year: year, contains: contains };","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/utils.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.min = min;\nexports.split = split;\n// like _.min\nfunction min(arr) {\n  return arr.map(function (item) {\n    return +item;\n  }).filter(function (item) {\n    return Number.isInteger(item);\n  }).reduce(function (current, next) {\n    return current < next ? current : next;\n  });\n}\n\nfunction merge(list) {\n  return list.join(' ').trim();\n}\n\n/**\n * split by multiple keywords in a sentence\n *\n * @example\n   split('Price le 200 and Price gt 3.5 or length(CompanyName) eq 19', ['and', 'or'])\n\n   [\n     'Price le 200',\n     'and',\n     'Price gt 3.5',\n     'or',\n     'length(CompanyName) eq 19'\n   ]\n*/\nfunction split(sentence) {\n  var keys = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var keysArray = keys;\n  if (!(keysArray instanceof Array)) {\n    keysArray = [keysArray];\n  }\n  var result = [];\n  var tmp = [];\n  var words = sentence.split(' ');\n  words.forEach(function (word) {\n    if (keysArray.indexOf(word) > -1) {\n      result.push(merge(tmp));\n      result.push(word);\n      tmp = [];\n    } else {\n      tmp.push(word);\n    }\n  });\n  result.push(merge(tmp));\n  return result;\n}","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/parser/orderbyParser.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n// ?$skip=10\n// ->\n// query.skip(10)\nexports.default = function (query, $orderby) {\n  return new Promise(function (resolve, reject) {\n    if (!$orderby) {\n      return resolve();\n    }\n\n    var order = {};\n    var orderbyArr = $orderby.split(',');\n\n    orderbyArr.map(function (item) {\n      var data = item.trim().split(' ');\n      if (data.length > 2) {\n        return reject('odata: Syntax error at \\'' + $orderby + '\\', ' + 'it\\'s should be like \\'ReleaseDate asc, Rating desc\\'');\n      }\n      var key = data[0].trim();\n      var value = data[1] || 'asc';\n      order[key] = value;\n      return undefined;\n    });\n    query.sort(order);\n    return resolve();\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/parser/skipParser.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _utils = require('./../utils');\n\n// ?$skip=10\n// ->\n// query.skip(10)\nexports.default = function (query, skip, maxSkip) {\n  return new Promise(function (resolve) {\n    if (isNaN(+skip)) {\n      return resolve();\n    }\n    var _skip = (0, _utils.min)([maxSkip, skip]);\n    if (_skip <= 0) {\n      return resolve();\n    }\n    query.skip(_skip);\n    return resolve();\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/parser/topParser.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _utils = require('./../utils');\n\n// ?$top=10\n// ->\n// query.top(10)\nexports.default = function (query, top, maxTop) {\n  return new Promise(function (resolve) {\n    if (isNaN(+top)) {\n      return resolve();\n    }\n    var _top = (0, _utils.min)([maxTop, top]);\n    if (_top <= 0) {\n      return resolve();\n    }\n    query.limit(_top);\n    return resolve();\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/parser/selectParser.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n// ?$select=Rating,ReleaseDate\n// ->\n// query.select('Rating ReleaseDate')\nexports.default = function (query, $select) {\n  return new Promise(function (resolve) {\n    if (!$select) {\n      return resolve();\n    }\n\n    var list = $select.split(',').map(function (item) {\n      return item.trim();\n    });\n\n    var selectFields = { _id: 0 };\n    var tree = query.model.schema.tree;\n    Object.keys(tree).map(function (item) {\n      if (list.indexOf(item) >= 0) {\n        if (item === 'id') {\n          selectFields._id = 1;\n        } else if (typeof tree[item] === 'function' || tree[item].select !== false) {\n          selectFields[item] = 1;\n        }\n      }\n      return undefined;\n    });\n\n    if (Object.keys(selectFields).length === 1 && selectFields._id === 0) {\n      return resolve();\n    }\n\n    query.select(selectFields);\n    return resolve();\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/rest/post.js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (req, MongooseModel) {\n  return new Promise(function (resolve, reject) {\n    if (!Object.keys(req.body).length) {\n      return reject({ status: 422 });\n    }\n\n    var entity = new MongooseModel(req.body);\n    return entity.save(function (err) {\n      if (err) {\n        return reject(err);\n      }\n      return resolve({ status: 201, entity: entity });\n    });\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/rest/put.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nfunction _updateEntity(resolve, reject, MongooseModel, req, entity) {\n  MongooseModel.findByIdAndUpdate(entity.id, req.body, function (err) {\n    if (err) {\n      return reject(err);\n    }\n    var newEntity = req.body;\n    newEntity.id = entity.id;\n    return resolve({ entity: newEntity, originEntity: entity });\n  });\n}\n\nfunction _createEntity(resolve, reject, MongooseModel, req, entity) {\n  var uuidReg = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n  if (!uuidReg.test(req.params.id)) {\n    return reject({ status: 400 }, { text: 'Id is invalid.' });\n  }\n  var newEntity = new MongooseModel(req.body);\n  newEntity._id = req.params.id;\n  return newEntity.save(function (err) {\n    if (err) {\n      return reject(err);\n    }\n    return resolve({ status: 201, entity: newEntity, originEntity: entity });\n  });\n}\n\nexports.default = function (req, MongooseModel) {\n  return new Promise(function (resolve, reject) {\n    MongooseModel.findOne({ _id: req.params.id }, function (err, entity) {\n      if (err) {\n        return reject(err);\n      }\n      return entity ? _updateEntity(resolve, reject, MongooseModel, req, entity) : _createEntity(resolve, reject, MongooseModel, req, entity);\n    });\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/rest/delete.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (req, MongooseModel) {\n  return new Promise(function (resolve, reject) {\n    MongooseModel.remove({ _id: req.params.id }, function (err, result) {\n      if (err) {\n        return reject(err);\n      }\n\n      if (JSON.parse(result).n === 0) {\n        return reject({ status: 404 }, { text: 'Not Found' });\n      }\n\n      return resolve();\n    });\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/rest/patch.js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports.default = function (req, MongooseModel) {\n  return new Promise(function (resolve, reject) {\n    return MongooseModel.findOne({ id: req.params.id }, function (err, entity) {\n      if (err) {\n        return reject(err);\n      }\n      return MongooseModel.update({ id: req.params.id }, _extends({}, entity, req.body), function (err1) {\n        if (err1) {\n          return reject(err1);\n        }\n        return resolve({ entity: req.body, originEntity: entity });\n      });\n    });\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/rest/get.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (req, MongooseModel) {\n  return new Promise(function (resolve, reject) {\n    MongooseModel.findById(req.params.id, function (err, entity) {\n      if (err) {\n        return reject(err);\n      }\n\n      if (!entity) {\n        return reject({ status: 404 }, { text: 'Not Found' });\n      }\n\n      return resolve({ entity: entity });\n    });\n  });\n};","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/ODataFunction.js":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = undefined;\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _default = function _default() {\n  _classCallCheck(this, _default);\n\n  /*eslint-disable */\n  return _express2.default.Router();\n  /*eslint-enable */\n};\n\nexports.default = _default;","/home/travis/build/npmtest/node-npmtest-node-odata/node_modules/node-odata/lib/metadata/parser.js":"// import mongoose from 'mongoose';\n\n// const isField = (obj) => {\n//   if (typeof(obj) === 'function') {\n//     return true;\n//   }\n//   if (typeof(obj) === 'object') {\n//     if (obj.type && typeof(obj.type) === 'function') {\n//       // 检测该 obj 下字段, 如果有除了 type 以外是 function 类型的字段, 表明该 obj 不是基本类型\n//       for(let name in obj){\n//         if (name !== 'type' && typeof(obj[name]) === 'function') {\n//           return false;\n//         }\n//       }\n//       return true;\n//     }\n//   }\n//   return false;\n// };\n\n// const isArray = (obj) => {\n//   return Array.isArray(obj) && obj.length >= 0;\n// };\n\n// const isComplexArray = (obj) => {\n//   return isArray(obj) && isField(obj[0]);\n// };\n\n// const isObject = (obj) => {\n//   return obj && typeof(obj) === 'object' && !isArray(obj) && !isField(obj);\n// };\n\n// const toMetadata = (obj) => {\n//   const convert = (obj, name, root) => {\n//     const LEN = 'function '.length;\n//     if (isField(obj[name])) {\n//       if (typeof(obj[name]) === 'function') {\n//         obj[name] = obj[name].toString();\n//         obj[name] = obj[name].substr(LEN, obj[name].indexOf('(') - LEN);\n//       }\n//       else if (typeof(obj[name]) === 'object') {\n//         obj[name].type = obj[name].type.toString();\n//         obj[name].type = obj[name].type.substr(LEN, obj[name].type.indexOf('(') - LEN);\n//       }\n//     }\n//     else if (isComplexArray(obj[name])) {\n//       for (let childName of obj[name][0]) {\n//         convert(obj[name][0], childName);\n//       }\n//     }\n//     else if (isArray(obj[name])) {\n//       obj[name][0] = obj[name][0].toString();\n//       obj[name][0] = obj[name][0].substr(LEN, obj[name][0].indexOf('(') - LEN);\n//     }\n//     else if (isObject(obj[name])) {\n//       Object.keys(obj[name]).map((childName) => {\n//         convert(obj[name], childName);\n//       });\n//     }\n//   };\n//   convert({obj: obj}, 'obj', true);\n//   return obj;\n// };\n\n// export default { toMetadata };\n\"use strict\";"}